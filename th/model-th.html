<html>
<head>
    <title>Buddha Amulet Detection and Identification Model</title>
	<meta name="robots" content="noindex">

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.20/lodash.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/async/3.2.0/async.min.js"></script>

  <link rel="shortcut icon" href="https://raw.githubusercontent.com/BADIM-PYproject/website/beta/assets/b-shortcut-logo.png">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.9.6/tailwind.min.css" rel="stylesheet">

    <style type="text/css">
		html, body {
			margin: 0;
			padding: 0;
            background-color: #272727;
            color: #272727;
      
		}

		body {
  	font-family: 'Inter', sans-serif;
  	color: whitesmoke;
	background-color: #272727;
	font-size: 16px;
	padding-bottom: 5rem;
}

.headline {
	font-size: 1.25rem;
	font-weight: 600;
  margin-right: 45rem;
}

.text--small {
	font-size: 0.875rem;
}

a {
	color: #D1AE1C;
	font-weight: 600;
}

a:hover {
	color: #edf2f7;
}

i {
	position: absolute;
	padding: 0.75rem;
	color: #D1AE1C;
}

span.icon {
	position: absolute;
	padding: 0.5rem;
	right: 0;
}

.header {
	background-color: #000;
	padding: 1rem;
	margin-bottom: 2.5rem;
  border-radius: 15px;
}

.header__grid {
	display: grid;
	grid-template-columns: repeat(1, minmax(0, 1fr));
	grid-template-rows: repeat(4, minmax(0, 1fr));
	gap: 1.5rem;
	max-width: 130rem;
  padding-bottom: 2rem;
}

.header__logo {
	height:180%;
  width: 250%;
}

.header__label {
	text-transform: uppercase;
	display: block;
	margin-bottom: 0.5rem;
  margin-top: 1rem;
	font-size: 0.875rem;
	font-weight: 600;
	color: whitesmoke;
}

.center {
  display: grid;
  place-items: center;
}

.content {
	padding: 1rem;
	width: 100%;
}

.content__grid {
	display: grid;
	grid-template-columns: repeat(12, minmax(0, 1fr));
	grid-template-rows: repeat(3, minmax(0, 1fr));
	max-width: 56rem;
	column-gap: 1rem;
	row-gap: 2.5rem;
	padding-top: 1rem;
	padding-bottom: 1rem;
}

.stage {
  box-sizing: border-box;
  position: absolute;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #65799b;
}

.btn {
  width: 200px;
  font-size: 20px;
  height: 60px;
  border: none;
  outline: none;
  background: #cea04b;
  color: #fff;
  cursor: pointer;
  position: relative;
  z-index: 0;
  border-radius: 10px;
}

.btn::before {
  position: absolute;
  content: "";
  width: calc(100% + 4px);
  height: calc(100% + 4px);
  left: -2px;
  top: -2px;
  background: linear-gradient(
    124deg,
    #ff2400,
    #e81d1d,
    #e8b71d,
    #e3e81d,
    #1de840,
    #1ddde8,
    #2b1de8,
    #dd00f3,
    #dd00f3
  );
  background-size: 400%;
  z-index: -1;
  filter: blur(5px);
  animation: move 20s linear infinite;
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
  border-radius: 15px;
}

.btn:hover::before {
  opacity: 1;
}

.btn::after {
  z-index: -1;
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  background: #cea04b;
  left: 0;
  top: 0;
  border-radius: 10px;
}

@keyframes move {
  0% {
    background-position: 0 0;
  }
  50% {
    background-position: 400% 0;
  }
  100% {
    background-position: 0 0;
  }
}
      
#imageOptions.content__grid {
    grid-template-rows: repeat(2, minmax(0, 0.5fr));
}

.flex {
	display: flex;
}

.flex-1 {
	flex: 1 1 0%;
}

.relative {
	position: relative;
}

.col-6-m3 {
	grid-column: span 6 / span 6;
}

.col-12-s6-m4, .col-12-m6, .col-12-m8, .col-12 {
	grid-column: span 12 / span 12;
}

.result {
	max-width: 56rem;
}

.result__header {
	display: flex;
	justify-content: space-between;
	margin-bottom: 1rem;
}

.divider {
	border-width: 1px;
	border-color: #cbd5e0;
	margin-top: 2.5rem;
	margin-bottom: 2.5rem;
	height: 0;
}

input:disabled {
	background-color: white;
  background: none;
  color: darkgrey;
}

.input {
	border-width: 1px;
	border-color: #cbd5e0;
  background: none;
	border-radius: 0.25rem;
	height: 2.5rem;
	width: 100%;
	padding-left: 0.5rem;
	padding-right: 0.5rem;
}

.input--left {
	border-top-right-radius: 0;
	border-bottom-right-radius: 0;
	margin-right: -1rem;
  background: none;
}

.input__icon {
	padding-left: 2.5rem;
	padding-right: 2.5rem;
}

.input__label {
	margin-bottom: 0.5rem;
	display: block;
}

.bttn {
	padding-top: 0.5rem;
	padding-bottom: 0.5rem;
	padding-left: 0.75rem;
	padding-right: 0.75rem;
	background-color: #616161;
	margin-right: -0.5rem;
	height: 2.5rem;
}

.bttn.fill {
	width: 50%;
}

.bttn:focus {
	outline: 1px dotted;
}

.bttn:hover {
	background-color: #3E3E3E;
}

.left {
	border-top-left-radius: 0.25rem;
	border-bottom-left-radius: 0.25rem;
}

.right {
	border-top-right-radius: 0.25rem;
	border-bottom-right-radius: 0.25rem;
	margin-right: 0;
}

.bttn.active {
	background-color: #cea04b;
	color: white;
	border: none;
  font-weight: bold;
}

.bttn__primary {
	background-color: #cea04b;
	color: white;
	border: none;
  font-weight: bold;
	font-size: 1.125rem;
	padding-left: 1.25rem;
	padding-right: 1.25rem;
	padding-top: 0.75rem;
	padding-bottom: 0.75rem;
}

.bttn.active:hover, .bttn__primary:hover {
	background-color: #8a6a30;
}

.codeblock {
	border-width: 1px;
	border-color: #cbd5e0
	border-radius: 0.25rem;
	display: block;
	padding: 0.75rem;
	background: none;
}
      
#urlContainer {
	display: none;
}

/* small breakpoint */
@media (min-width: 640px) {
	.header {
		padding: 2.5rem;
	}
	.header__grid {
		grid-template-columns: repeat(2, minmax(0, 1fr));
		grid-template-rows: repeat(2, minmax(0, 1fr));
	}
	.header__logo {
		grid-column: span 2 / span 2;
	}
	.content {
		padding: 2.5rem;
	}
	.content__grid {
		column-gap: 1rem;
		row-gap: 2.5rem;
	}
	.col-12-s6-m4 {
		grid-column: span 6 / span 6;
	}
}

/* medium breakpoint */
@media (min-width: 768px) {
	.header__grid {
		grid-template-columns: repeat(4, minmax(0, 1fr));
		grid-template-rows: repeat(1, minmax(0, 1fr));
	}
	.header__logo {
		grid-column: span 1 / span 1;
	}
	.col-6-m3 {
		grid-column: span 3 / span 3;
	}
	.col-12-s6-m4 {
		grid-column: span 4 / span 4;
	}
	.col-12-m6 {
		grid-column: span 6 / span 6;
	}
	.col-12-m8 {
		grid-column: span 8 / span 8;
	}
	.bttn {
		padding-left: 1rem;
		padding-right: 1rem;
	}
}
    </style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
<link href="/infer.css" rel="stylesheet"></head>
<body class="center" style="font-family: 'IBM Plex Sans Thai', sans-serif;">
<form id="inputForm">
    <div class="header">
        <div class="header__grid">
            <a href="https://badim-pyproject.github.io/website/"><img class="header__logo" src="https://raw.githubusercontent.com/BADIM-PYproject/website/beta/assets/badim-web-logo.svg" alt="Buddha Amulet Detection and Identification Model"></a>
            <div>
                <label class="header__label" for="model" style="font-size: 18px;">โมเดล</label>
                <input class="input" type="text" id="model" disabled/>
            </div>
            <div>
                <label class="header__label" for="version" style="font-size: 18px;">เวอร์ชัน</label>
                <input class="input" type="number" id="version" disabled/>
            </div>
            <div>
                <label class="header__label" for="api_key" style="font-size: 18px;">API Key</label>
                <input class="input" type="password" id="api_key" disabled/>
            </div>
        </div>
    </div>

    <div class="center" class="content">
      <p style="font-size: 28px;"><strong>พระเครื่องที่รองรับ</strong></p>
      <p>พระนางพญา พิษณุโลก • พระกริ่ง • พระกริ่งมหาราช • พระกลีบบัว • พระซุ้มกอ</p>
      <p>พระครูวัดเงินคลองเตย • พระวัดพลับ • พระรอด • พระผงสุพรรณ • พระรอดวัดมหาวัน </p>
      <p>สมเด็จวัดระฆัง • สมเด็จบางขุนพรม • สมเด็จวัดเกศไชโย </p>
      <br>
        <div class="content__grid">
            <div class="col-12-s6-m4" id="method">
                <label class="input__label" style="font-size: 20px; width:18rem"><b>วิธีอัปโหลด</b></label>
                <div>
                    <button data-value="upload" id="computerButton" class="bttn left fill active" style="width: 7.5rem">อัปโหลดไฟล์</button>
                    <button data-value="url" id="urlButton" class="bttn right fill" style="width: 5rem">URL</button>
                </div>
            </div>

            <div class="col-12-m8" id="fileSelectionContainer">
                <label class="input__label" for="file" style="font-size: 20px;"><b>เลือกไฟล์</b></label>
                <div class="flex">
                    <input class="input input--left flex-1" type="text" id="fileName" disabled />
                    <button id="fileMock" class="bttn right active"">ค้นดู</button>
                </div>
                <input style="display: none;" type="file" id="file" />
            </div>

            <div class="col-12-m8" id="urlContainer">
                <label class="input__label" for="file" style="font-size: 20px;"><b>ใส่ URL ภาพ</b></label>
                <div class="flex">
                    <input type="text" id="url" placeholder="https://path.to/your.jpg" class="input"/><br>
                </div>
            </div>

            <div class="col-12-m6">
                <label class="input__label" for="classes" style="font-size: 20px;"><b>กรองคลาส</b> (ไม่บังคับ)</label>
                <input type="text" id="classes" placeholder="ใส่ชื่อคลาส" class="input"/><br>
                <span class="text--small">ใช้ลูกน้ำแยกชื่อคลาส</span>
            </div>

            <div class="col-6-m3 relative">
                <label class="input__label" for="confidence" style="font-size: 20px;">ความมั่นใจ (ขั้นต่ำ)</label>
                <div>
                    <i class="fas fa-crown"></i>
                    <span class="icon">%</span>
                    <input type="number" id="confidence" value="40" max="100" accuracy="2" min="0" class="input input__icon"/></div>
                </div>
            <div class="col-6-m3 relative">
                <label class="input__label" for="overlap" style="font-size: 20px;">การทับซ้อนกัน (สูงสุด)</label>
                <div>
                    <i class="fas fa-object-ungroup"></i>
                    <span class="icon">%</span>
                    <input type="number" id="overlap" value="30" max="100" accuracy="2" min="0" class="input input__icon"/></div>
            </div>
            <div class="col-6-m3" id="format">
                <label class="input__label" style="font-size: 20px;"><b>ผลลัพธ์ Inference</b></label>
                <div>
                    <button id="imageButton" data-value="image" class="bttn left fill active">รูปภาพ</button>
                    <button id="jsonButton" data-value="json" class="bttn right fill">JSON</button>
                </div>
            </div>
            <div class="col-12 content__grid" id="imageOptions">
                <div class="col-12-s6-m4" id="labels">
                    <label class="input__label" style="font-size: 20px;"><b>Labels</b></label>
                    <div>
                        <button class="bttn left">ปิด</button>
                        <button data-value="on" class="bttn right active">เปิด</button>
                    </div>
                </div>
                <div class="col-12-s6-m4" id="stroke">
                    <label class="input__label" style="font-size: 20px;"><b>ความหนาเส้นขอบ</b></label>
                    <div>
                        <button data-value="1" class="bttn left">1px</button>
                        <button data-value="2" class="bttn active">2px</button>
                        <button data-value="5" class="bttn">5px</button>
                        <button data-value="10" class="bttn right">10px</button>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <button type="submit" value="Run Inference" id="bttn__primary" class="btn" style="box-shadow: 2px 4px 4px rgba(0, 0, 0, 0.25);
border-radius: 10px;"><b>รัน Inference</b></button>
            </div>
        </div>
        <div class="result" id="resultContainer">
            <div class="divider"></div>
            <div class="result__header">
                <h3 class="headline">ผลลัพธ์</h3>
                <a href="#">คัดลอกโค้ด</a>
            </div>
            <pre id="output" class="codeblock"/></pre>
        </div>
    </div>
</form>

<script type="text/javascript">
$(function() {
	//values pulled from query string
	$('#model').val("detecting-amulets");
	$('#version').val("1");
	$('#api_key').val("DLBDKBWbgddONiE5UbE0");

	setupButtonListeners();
});

var infer = function() {
	$('#output').html("Inferring...");
	$("#resultContainer").show();
	$('html').scrollTop(100000);

	getSettingsFromForm(function(settings) {
		settings.error = function(xhr) {
			$('#output').html("").append([
				"Error loading response.",
				"",
				"Check your API key, model, version,",
				"and other parameters",
				"then try again."
			].join("\n"));
		};

		$.ajax(settings).then(function(response) {
			if(settings.format == "json") {
				var pretty = $('<pre>');
				var formatted = JSON.stringify(response, null, 4)

				pretty.html(formatted);
				$('#output').html("").append(pretty);
				$('html').scrollTop(100000);
			} else {
				var arrayBufferView = new Uint8Array(response);
				var blob = new Blob([arrayBufferView], {
					'type': 'image\/jpeg'
				});
				var base64image = window.URL.createObjectURL(blob);

				var img = $('<img/>');
				img.get(0).onload = function() {
					$('html').scrollTop(100000);
				};
				img.attr('src', base64image);
				$('#output').html("").append(img);
			}
		});
	});
};

var retrieveDefaultValuesFromLocalStorage = function() {
	try {
		var api_key = localStorage.getItem("rf.api_key");
		var model = localStorage.getItem("rf.model");
		var format = localStorage.getItem("rf.format");

		if (api_key) $('#api_key').val(api_key);
		if (model) $('#model').val(model);
		if (format) $('#format').val(format);
	} catch (e) {
		// localStorage disabled
	}

	$('#model').change(function() {
		localStorage.setItem('rf.model', $(this).val());
	});

	$('#api_key').change(function() {
		localStorage.setItem('rf.api_key', $(this).val());
	});

	$('#format').change(function() {
		localStorage.setItem('rf.format', $(this).val());
	});
};

var setupButtonListeners = function() {
	// run inference when the form is submitted
	$('#inputForm').submit(function() {
		infer();
		return false;
	});

	// make the buttons blue when clicked
	// and show the proper "Select file" or "Enter url" state
	$('.bttn').click(function() {
		$(this).parent().find('.bttn').removeClass('active');
		$(this).addClass('active');

		if($('#computerButton').hasClass('active')) {
			$('#fileSelectionContainer').show();
			$('#urlContainer').hide();
		} else {
			$('#fileSelectionContainer').hide();
			$('#urlContainer').show();
		}

		if($('#jsonButton').hasClass('active')) {
			$('#imageOptions').hide();
		} else {
			$('#imageOptions').show();
		}

		return false;
	});

	// wire styled button to hidden file input
	$('#fileMock').click(function() {
		$('#file').click();
	});

	// grab the filename when a file is selected
	$("#file").change(function() {
		var path = $(this).val().replace(/\\/g, "/");
		var parts = path.split("/");
		var filename = parts.pop();
		$('#fileName').val(filename);
	});
};

var getSettingsFromForm = function(cb) {
	var settings = {
		method: "POST",
	};

	var parts = [
		"https://detect.roboflow.com/",
		$('#model').val(),
		"/",
		$('#version').val(),
		"?api_key=" + $('#api_key').val()
	];

	var classes = $('#classes').val();
	if(classes) parts.push("&classes=" + classes);

	var confidence = $('#confidence').val();
	if(confidence) parts.push("&confidence=" + confidence);

	var overlap = $('#overlap').val();
	if(overlap) parts.push("&overlap=" + overlap);

	var format = $('#format .active').attr('data-value');
	parts.push("&format=" + format);
	settings.format = format;

	if(format == "image") {
		var labels = $('#labels .active').attr('data-value');
		if(labels) parts.push("&labels=on");

		var stroke = $('#stroke .active').attr('data-value');
		if(stroke) parts.push("&stroke=" + stroke);

		settings.xhr = function() {
			var override = new XMLHttpRequest();
			override.responseType = 'arraybuffer';
			return override;
		}
	}

	var method = $('#method .active').attr('data-value');
	if(method == "upload") {
		var file = $('#file').get(0).files && $('#file').get(0).files.item(0);
		if(!file) return alert("Please select a file.");

		getBase64fromFile(file).then(function(base64image) {
			settings.url = parts.join("");
			settings.data = base64image;

			console.log(settings);
			cb(settings);
		});
	} else {
		var url = $('#url').val();
		if(!url) return alert("Please enter an image URL");

		parts.push("&image=" + encodeURIComponent(url));

		settings.url = parts.join("");
		console.log(settings);
		cb(settings);
	}
};

var getBase64fromFile = function(file) {
	return new Promise(function(resolve, reject) {
		var reader = new FileReader();
		reader.readAsDataURL(file);
		reader.onload = function() {
		resizeImage(reader.result).then(function(resizedImage){
			resolve(resizedImage);
		});
    };
		reader.onerror = function(error) {
			reject(error);
		};
	});
};


var resizeImage = function(base64Str) {

	return new Promise(function(resolve, reject) {
		var img = new Image();
		img.src = base64Str;
		img.onload = function(){
			var canvas = document.createElement("canvas");
			var MAX_WIDTH = 1500;
			var MAX_HEIGHT = 1500;
			var width = img.width;
			var height = img.height;
			if (width > height) {
				if (width > MAX_WIDTH) {
					height *= MAX_WIDTH / width;
					width = MAX_WIDTH;
				}
			} else {
				if (height > MAX_HEIGHT) {
					width *= MAX_HEIGHT / height;
					height = MAX_HEIGHT;
				}
			}
			canvas.width = width;
			canvas.height = height;
			var ctx = canvas.getContext('2d');
			ctx.drawImage(img, 0, 0, width, height);
			resolve(canvas.toDataURL('image/jpeg', 1.0));  
		};
    
	});	
};

</script>

<!-- <style>
#codepenLink {
	position: fixed;
	bottom:0;
	right: 0;
}
#codepenLink img {
	height: 48px;
}
</style> -->
<script src="/infer.e52137ed1b27e0a86d5a.js"></script>
</body>
</html>
